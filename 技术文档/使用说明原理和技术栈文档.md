# 软件使用说明、原理和技术栈文档

## 1. 使用说明

本软件提供了一个引导模式（Guided Mode），旨在通过语音指导用户进行冥想或放松练习。

### 启动引导模式
1.  在前端界面中，找到并点击“引导模式”或类似的按钮。
2.  系统将通过语音开始播放引导内容。

### 交互
-   在引导模式下，您将听到由文本转语音（TTS）技术生成的语音。
-   如果遇到播放问题，请确保您的系统时间已与网络时间同步，并且网络连接正常。

### 故障排除
-   **无语音输出或播放失败**：
    -   检查您的网络连接。
    -   确保您的系统时间已正确同步。
    -   如果问题持续存在，请联系技术支持并提供详细的错误信息。

## 2. 原理

本软件的核心功能是利用文本转语音（Text-to-Speech, TTS）技术，将预设的文本内容实时转换为语音输出。其主要原理如下：

### 2.1 文本转语音（TTS）
-   **核心库**：`edge-tts`。这是一个基于 Microsoft Edge 浏览器内置 TTS 服务的 Python 库，能够提供高质量、自然发音的语音合成。
-   **工作流程**：
    1.  前端（UI）向后端发送文本内容（可以是纯文本或 SSML 格式）。
    2.  后端 `app.py` 接收到文本后，调用 `edge-tts` 库进行语音合成。
    3.  `edge-tts` 库通过 WebSocket 连接到 Microsoft Edge TTS 服务，发送文本并接收音频流。
    4.  接收到的音频数据（通常是 MP3 格式的二进制数据块）通过 WebSocket 回传给前端。
    5.  前端接收到音频数据后进行解码和播放。

### 2.2 WebSocket 通信
-   **实时性**：前端与后端之间使用 WebSocket 协议进行通信，实现音频数据的实时传输，确保语音播放的流畅性。
-   **双向通信**：WebSocket 允许服务器和客户端之间进行双向通信，前端可以发送文本请求，后端可以实时推送音频数据。

### 2.3 SSML 支持
-   **增强控制**：软件支持 SSML（Speech Synthesis Markup Language），允许通过标记语言更精细地控制语音的语速、语调、音量、停顿以及切换发音人等。
-   **解析与合成**：后端 `app.py` 能够解析简单的 SSML 标签，并将其传递给 `edge-tts` 进行合成，以实现更丰富的语音表现力。

### 2.4 错误处理
-   **Sec-MS-GEC 令牌**：`edge-tts` 在与 Microsoft Edge TTS 服务通信时，需要有效的 `Sec-MS-GEC` 令牌进行身份验证。如果令牌无效或过期，可能会导致 401 或 403 错误，从而导致语音合成失败。
-   **连接异常**：后端对 WebSocket 连接和 `edge-tts` 合成过程中的异常进行了捕获，并在发生错误时关闭连接，以便前端进行相应的错误处理和回退。

## 3. 技术栈

### 3.1 后端
-   **Python**：主要编程语言。
-   **`websockets` 库**：用于构建 WebSocket 服务器，处理前端与后端之间的实时通信。
-   **`edge-tts` 库**：用于实现文本转语音功能，通过连接 Microsoft Edge TTS 服务进行语音合成。
-   **`asyncio` 库**：Python 的异步 I/O 框架，用于处理并发连接和非阻塞操作。
-   **`json` 库**：用于处理前端发送的 JSON 格式数据。
-   **`re` 库**：用于正则表达式操作，例如 SSML 标签的检测和剥离。
-   **`xml.etree.ElementTree` 库**：用于解析和处理 SSML 格式的 XML 数据。

### 3.2 前端
-   **React**：用于构建用户界面的 JavaScript 库。
-   **Vite**：下一代前端开发与构建工具。
-   **HTML/CSS/JavaScript**：基础的网页开发技术。
-   **WebSocket API**：浏览器内置的 WebSocket 客户端 API，用于与后端建立 WebSocket 连接并进行通信。
-   **其他可能的库**：根据项目需求，可能还会使用状态管理库（如 Redux、Zustand）、UI 组件库（如 Ant Design、Material-UI）等。