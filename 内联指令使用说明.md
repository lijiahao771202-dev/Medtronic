# 冥想引导内联指令使用说明（Guided Mode Inline Commands）

本项目的“脚本引导（精确）”模式支持在文本中嵌入内联指令来控制停顿与语速。你可以在 Agent 页面文本框中直接粘贴或输入带有这些指令的脚本，然后点击“开始引导”进行朗读。

当前已实现的指令：

1) [pause:...]
- 作用：插入停顿。
- 写法：
  - 毫秒：[pause:1500]（1500ms）
  - 秒：[pause:2s]（2秒）
- 规则：相邻的停顿会自动合并为一个更长的停顿；标点（逗号、句号、问号、叹号、冒号、换行）也会产生默认停顿。

2) [rate:...]
- 作用：临时调整其后的语速（局部覆盖滑条设置）。
- 写法：
  - 百分比：[rate:-10%]、[rate:+5%]
  - 倍速（自动换算为百分比）：[rate:0.9]（相当于 -10%）、[rate:1.1]（相当于 +10%）
- 规则：指令影响其后出现的片段；遇到下一个 [rate:...] 会再次更新语速。

尚未实现但可扩展的指令：
- [pitch:...]（临时调整音高，如 [pitch:+2st] 或 [pitch:-100Hz]）
- [voice:...]（临时切换 TTS 声音）
如有需要，请在需求中明确格式，我们可按你的习惯增补。

## 使用步骤
1. 打开 http://localhost:5173/ 进入 Agent 页面。
2. 在“朗读文本（支持 [pause:...] 指令）”的文本框中粘贴或输入脚本文本。
3. 选择声音、调整“语速”和“音高”（滑条为默认值，文本内联指令可局部覆盖）。
4. 点击“开始引导”，朗读将按标点与指令精确排程播放。

## 示例文本
基础呼吸引导：
```
吸气……[pause:2000]呼气……[pause:3s]放松肩膀。[pause:1500]让面部肌肉自然松弛，眉心柔软。
```

标点 + 指令合并测试：
```
现在，轻轻闭上眼睛。[pause:1000]让呼吸自然，缓慢而稳定。观察胸腔的起伏。
```
说明：句号自带约700ms停顿；紧随其后的 [pause:1000] 会被合并，形成约1700ms 的总停顿。

语速指令测试：
```
吸气……[pause:2000]呼气……[rate:-10%]放慢节奏，感受呼吸的长度。[pause:1500]
继续保持觉察。[rate:0.9]让每一句话更从容。[pause:1200]
如果需要稍快一些，[rate:+5%]调整到更灵活的节奏。
```

身体扫描片段：
```
现在，请把注意力带到头顶。[pause:1200]感受头皮的微微放松。
把注意力移动到眼周，放松眼眶和眉心。[pause:1000]如果发现紧张，轻轻呼气，让它缓慢释放。
注意力继续下移到肩膀和双臂。[pause:1500]感受手掌与指尖的温度变化。
让注意力来到胸口，观察呼吸的起伏。[pause:2000]每一次吸气，都带来清新；每一次呼气，都带走疲惫。
最后，把注意力放到腹部与下肢。[pause:2.5s]感受身体与地面的接触，稳固而安定。
```

## DeepSeek 提示词建议

将以下“系统提示词”和“用户提示词”用于 Agent 页的生成器，以便自动生成包含内联指令的冥想脚本。

系统提示词（System Prompt）：
```
你是一名冥想脚本生成助手。请用中文生成适合朗读的冥想脚本，语气温柔，结构清晰，长度可供 3–6 分钟朗读。
脚本文本需内嵌以下内联指令以控制停顿与语速：
- [pause:...] 插入停顿（支持毫秒与秒，如 [pause:1500] 或 [pause:2s]）。
- [rate:...] 临时调整语速（支持百分比与倍速，如 [rate:-10%]、[rate:+5%]、[rate:0.9]）。
请合理在段落之间与关键语句后使用 [pause:...]，并在需要强调“放慢”或“略微加快”的句子前使用 [rate:...]。
要求：
1) 用自然标点组织语句；避免过度使用省略号；
2) 段落之间保持流畅，避免生硬的指令堆砌；
3) 最终只输出纯脚本文本，不要附加任何说明或标注。
```

用户提示词模板（User Prompt）：
```
请生成一段关于“放松身心”的冥想脚本，时长约 5 分钟，包含呼吸引导、身体扫描、情绪觉察与温柔收尾。
脚本中请合理嵌入 [pause:...] 与 [rate:...] 指令：
- 在重要句子或段落间加入 [pause:1500]~[pause:3000] 的停顿；
- 在需要放慢的地方使用 [rate:-10%] 或 [rate:0.9]；在需要略微加快时使用 [rate:+5%]；
只输出纯文本脚本，不要任何解释或标题。
```

快速测试用简短提示：
```
生成 2–3 段的短版呼吸引导脚本，适当加入 [pause:2000] 和 [rate:-10%] 展示效果；严格只输出脚本文本。
```

## 故障排查
- 如果点击“开始引导”后无声音，检查后端 WebSocket（默认 ws://localhost:8008）是否可用。
- DeepSeek API 网络错误不会影响你手动粘贴文本的引导播放；可直接在文本框输入并播放。
- 如需更长停顿，推荐使用 [pause:10s] 这类秒单位写法，避免毫秒数字过大不易读。

## 版权与用法
本说明用于指导在项目中编写带内联指令的冥想脚本。文本版权归原作者或使用者所有，生成内容请遵守相应平台与法律法规。